{% extends 'base.html' %}
{% load static %}
{% block content %}
{% load bootstrap4 %}
{# import bootstrap4/bootstrap3 #}
{% bootstrap_css %} {# Embed Bootstrap CSS #}
{% bootstrap_javascript jquery='full' %} {# Embed Bootstrap JS+jQuery #}
{{ form.media }} {# Adds date-picker required JS and CSS #}

<div>
  <div class="container">
    {% if messages %}
    {% for message in messages %}
    <div class="alert alert-success alert-dismissible fade show" role="alert">
      <strong class="text-success"></strong> {{ message }}
      <button type="button" class="close" data-dismiss="alert"
        aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    {% endfor %}
    {% endif %}
  </div>
  <section>
    <div class="owl-carousel salon-details-slider owl-theme">
      <div class="item">
        <img src="{% static 'images/'%}1.jpg" alt="{{ salon.name }}">
      </div>
      <div class="item">
        <img src="{% static 'images/'%}2.jpg" alt="{{ salon.name }}">
      </div>
      <div class="item">
        <img src="{% static 'images/'%}3.jpg" alt="{{ salon.name }}">
      </div>
      <div class="item">
        <img src="{% static 'images/'%}4.jpg" alt="{{ salon.name }}">
      </div>
    </div>
  </section>
  <section>
    <div class="container mt-1">
      <div class="row">
        <div class="col-sm-8">
          <h3>{{ salon.name }}</h3>
          <p>{{ salon.location_description }}</p>
        </div>
        <div class="col-sm-4">
          <div class="review-card-summary row">
            <div class="review-stars-average col-3 text-danger">
              {{ average_rating }}
            </div>
            <div class="review-stars-wrapper col-9">
              <div class="d-inline-flex">
                <div class="rating_stars_container d-flex">
                  <i class="ti-star icon-large"></i>
                  <i class="ti-star icon-large"></i>
                  <i class="ti-star icon-large"></i>
                  <i class="ti-star icon-large"></i>
                  <i class="ti-star icon-large"></i>
                </div>
              </div>
              <p class="text-muted my-0">{{salon.reviews.count}} Ratings</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- body  -->
  <div class="container">
    <section>
      <div class="services-products">

        <ul class="nav nav-justified services-products-toggler mt-3 mb-2">
          <li class="nav-item"><a data-toggle="tab" href="#services"
              class="active nav-link">Services</a></li>
          <li class="nav-item"><a data-toggle="tab" href="#products"
              class="nav-link">Products</a></li>
        </ul>

        <!-- Sticky filter -->
        {% if services or products %}
        <div class="container-fluid card sticky-top"
          style="background-color:white">
          <div class="row align-items-center pt-3 justify-content-center">
            <div class="col-3 col-sm-2">
              <div class="filters">
                <h5><i class="ti-bolt text-teal"></i><span class="d-none
                    d-sm-inline"> Popular</span>
                </h5>
              </div>
            </div>
            <div class="col-3 col-sm-2">
              <div class="filters">
                <h5><i class="ti-location-pin text-teal"></i><span class="d-none
                    d-sm-inline"> Near me</span>
                </h5>
              </div>
            </div>
            <div class="col-3 col-sm-2">
              <div class="filters">
                <h5><i class="ti-thumb-up text-teal"></i><span class="d-none
                    d-sm-inline"> Recommended</span></h4>
              </h5>
            </div>
          </div>
          <div class="col-3 col-sm-2">
            <div class="filters">
              <h5> <i class="ti-gift text-teal"></i> <span class="d-none
                  d-sm-inline">Offers</span>
              </h5>
            </div>
          </div>
        </div>
      </div>
      {% endif %}


      <div class="tab-content mt-3">
        <div class="tab-pane active" id="services" role="tabpanel">
          <div class="card border-0">
            {% for service in services %}
            <div class="row">
              <div class="col-8">
                <h5 class="mb-0">{{service.name}}</h5>
                <p class="text-muted">{{service.duration}} Min</p>
              </div>
              <div class="col-4">
                <p class="mb-0">Ksh <b>{{service.cost}}</b></p>
                <button class="btn not-clicked mr-0 py-0 mt-2"
                  id="{{service.id}}">Add</button>
              </div>
            </div>
            <hr class="mt-1 mb-3">
            {% empty %}
            <div class="container my-3 text-muted text-center">
              <p>We Have no services at the moment. Please check again later</p>
            </div>
            {% endfor %}
          </div>

        </div>
        <div class="tab-pane" id="products" role="tabpanel">
          <div class="card border-0">
            {% for product in products %}
            <div class="row">
              <div class="col-8">
                <h5 class="mb-0">{{product.name}}</h5>
                <p class="text-muted">{{product.duration}} Min</p>
              </div>
              <div class="col-4">
                <p class="mb-0 font-weight-bold">Ksh {{product.price}}</p>
                <button class="btn btn-outline-success py-0">add</button>
              </div>
            </div>
            <hr class="my-1">
            {% empty %}
            <div class="container my-3 text-muted text-center">
              <p>We Have no products at the moment. Please check again later</p>
            </div>
            {% endfor %}
          </div>

        </div>
      </div>
    </div>
  </section>
</div>
<section>
  <div class="container">
    <h3 class="mb-3 review-title">Reviews Zone</h3>
    <div class="row">
      <div class="col-sm-4">
        <div class="review-card-summary d-flex">
          <div class="review-stars-average text-danger">
            {{ average_rating }}
          </div>
          <div class="review-stars-wrapper d-flex">
            <div class="d-inline-flex">
              <div class="rating_stars_container d-flex">
                <i class="ti-star icon-large"></i>
                <i class="ti-star icon-large"></i>
                <i class="ti-star icon-large"></i>
                <i class="ti-star icon-large"></i>
                <i class="ti-star icon-large"></i>
              </div>
            </div>
            <p class="text-muted mt-3">{{salon.reviews.count}} Ratings</p>
          </div>
        </div>
      </div>
      <div class="col-sm-4">
        <div class="rate-criteria-item">
          <p class="rate-criteria-name">Cleanliness</p>
          <div class="d-inline-flex">
            <div class="rating_stars_container d-flex">
              <i class="ti-star icon-medium"></i>
              <i class="ti-star icon-medium"></i>
              <i class="ti-star icon-medium"></i>
              <i class="ti-star icon-medium"></i>
              <i class="ti-star icon-medium"></i>
            </div>
          </div>
        </div>
        <div class="rate-criteria-item">
          <p class="rate-criteria-name">Ambience</p>
          <div class="d-inline-flex">
            <div class="rating_stars_container d-flex">
              <i class="ti-star icon-medium"></i>
              <i class="ti-star icon-medium"></i>
              <i class="ti-star icon-medium"></i>
              <i class="ti-star icon-medium"></i>
              <i class="ti-star icon-medium"></i>
            </div>
          </div>
        </div>
      </div>
      <div class="col-sm-4">
        <div class="rate-criteria-item">
          <p class="rate-criteria-name">Staff</p>
          <div class="d-inline-flex">
            <div class="rating_stars_container d-flex">
              <i class="ti-star icon-medium"></i>
              <i class="ti-star icon-medium"></i>
              <i class="ti-star icon-medium"></i>
              <i class="ti-star icon-medium"></i>
              <i class="ti-star icon-medium"></i>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-md-4 offset-md-0 col-sm-8 offset-sm-4">
        <div class="review-filters">
          <h3 class="review-filter-title mb-3">Filter Reviews</h3>
          <div class="review-filter-ratingField d-flex mb-2 mt-1">
            Rating
            <div class="review-filter-rating">
              Filter by Rating
              <i class="ti-angle-down"></i>
            </div>
          </div>
        </div>
      </div>
      <div class="reviews-list col-xs-12 col-sm-8 offset-sm-4 offset-md-0">
        <div class="col-sm-12 mb-3 px-0">
          <div class="py-3 d-flex show-review-form">
            <h4 class="write-review-title">Write your review</h4>
            <i class="ti-pencil-alt text-success ml-auto"></i>
          </div>
          <form method="post" class="review-form">
            {% csrf_token %}
            {% include 'utils/star-widget-field.html' with category='ambience'%}
            {% include 'utils/star-widget-field.html' with
            category='cleanliness'%}
            {% include 'utils/star-widget-field.html' with category='staff'%}
            <div class="review-form">
              {% bootstrap_form review_form %}
            </div>
            {% if request.user.is_authenticated %}
            <button type="submit" class="btn btn-success">Submit</button>
            {% else %}
            <p>You must <a href="{% url 'login'%}" class="btn-link text-danger">Login</a>
              to submit a review.</p>
            {% endif %}
          </form>
        </div>
        {% for review in reviews %}
        <div class="review-item col-sm-12">
          <div class="review-item-stars">
            <div class="d-inline-flex">
              <div class="rating_stars_container d-flex">
                <i class="ti-star icon-large"></i>
                <i class="ti-star icon-large"></i>
                <i class="ti-star icon-large"></i>
                <i class="ti-star icon-large"></i>
                <i class="ti-star icon-large"></i>
              </div>
            </div>
          </div>
          <div class="review-item-content">
            {{ review.message }}
          </div>
          <div class="review-item-meta text-muted d-flex">
            <span class="review-item-author">{{ review.author }}</span>
            <i class="ti-check-box text-success"></i>
            <span class="review-item-seperator text-dark">•</span>
            {{ review.created_date }}
            <a href="/" class="btn-link text-danger ml-auto">Report</a>
          </div>
        </div>
        {% empty %}
        <div class="text-center col-sm-12">
          <p class="text-capitalize text-muted">No Reviews yet!</p>
        </div>
        {% endfor %}
      </div>
    </div>
  </section>
  <section>
    <div title="closed" class="cart">
      <div class="row cart-buttons-container mx-0">
        <div class="col-4 cart-amount container text-white">
          <p class="mt-2 ml-2"><b class="cart-items-counter"
              id="total_items_booked">0</b></p>
        </div>
        <div class="col-4 cart-icon-container">
          <div class="icon-container text-white col-4 rounded-circle">
            <i class="ti-shopping-cart cart-icon"></i>
          </div>
        </div>
        <div class="col-4 bg-danger cart-cost text-center text-white">
          <p class="mt-3"><b>Ksh 500</b></p>
        </div>
      </div>
      <div class="container display-selected-items pt-4 cart-items-container">
        <p class="text-center text-muted">You have not selected any services or
          products.</p>
      </div>
    </div>
  </section>

  <!-- end of body  -->
</div>

<script>

  // Adding elements to cart, toggling state of add to cart button and pushing items to array
  var items_booked = 0
  var services_selected = []
  $(".not-clicked").on("click", function (event) {
    var el = $(event.target);
    if (el.text() == "Add") {
      // Add selected service to array on clicking add
      var selected_service = parseInt(event.target.id)
      console.log(typeof (selected_service))
      services_selected.indexOf(selected_service) === -1 ? services_selected.push(selected_service) :
        console.log(services_selected)

      el.text("Added");
      $(this).addClass('clicked').removeClass('not-clicked');
      items_booked += 1
      $('#total_items_booked').html(items_booked)
      console.log('items booked ' + items_booked)
      console.log(services_selected)
    } else {
      // Removes item from cart when remove button is clicked
      var selected_service = parseInt(event.target.id)
      if (services_selected.includes(selected_service)) {
        var index = services_selected.indexOf(selected_service);
        if (index !== -1) services_selected.splice(index, 1);
      }

      el.text("Add");
      $(this).addClass('not-clicked').removeClass('clicked');
      if (items_booked != 0) {
        items_booked -= 1
        $('#total_items_booked').html(items_booked)
        console.log('items booked ' + items_booked)
      } else {
        items_booked = 0
        $('#total_items_booked').html(items_booked)
        console.log(items_booked)
      }
      console.log(services_selected)
    }
  });

  // Slide chart up or down
  $('.cart-buttons-container').on('click', function () {
    var cart_state = $('.cart').attr('title')
    if (cart_state == 'closed') {
      $('.cart').addClass('show-cart-items').removeClass('hide-cart-items');
      $('.cart').prop('title', 'opened');
    } else {
      $('.cart').addClass('hide-cart-items').removeClass('show-cart-items');
      $('.cart').prop('title', 'closed');
    }
  });

</script>
{% endblock %}

<!-- '<div class="row my-2"><div class="col-10"><h6 class="mb-0">'+ services.i.name +'</h6><p class="text-muted">Ksh '+ services.i.cost +'</p></div><div class="col-2"><button class="btn btn-outline-success py-0">add</button></div></div>' -->